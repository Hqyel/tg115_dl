<!DOCTYPE html>
<html lang="zh-CN" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG 资源爬虫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        [v-cloak] {
            display: none !important;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .break-all {
            word-break: break-all;
        }
    </style>
</head>

<body
    class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen transition-colors duration-300">
    <div id="app" v-cloak>
        <!-- 登录页面 -->
        <div v-if="!isLoggedIn" class="min-h-screen flex">
            <div class="hidden lg:flex lg:w-1/2 relative overflow-hidden">
                <img src="https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=1200"
                    class="absolute inset-0 w-full h-full object-cover" alt="bg">
                <div class="absolute inset-0 bg-gradient-to-br from-violet-600/90 to-indigo-900/90"></div>
                <div class="relative z-10 flex flex-col justify-center px-16">
                    <div class="flex items-center gap-3 mb-8">
                        <div
                            class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                            <img src="https://unpkg.com/lucide-static@latest/icons/film.svg" class="w-7 h-7 invert">
                        </div>
                        <span class="text-2xl font-bold text-white">TG 资源爬虫</span>
                    </div>
                    <h1 class="text-4xl font-bold text-white mb-4 leading-tight">智能采集<br>115 网盘资源</h1>
                    <p class="text-white/70 text-lg max-w-md">自动爬取 Telegram 公开频道，智能解析并提取 115 网盘链接。</p>
                </div>
            </div>
            <div class="flex-1 flex items-center justify-center p-8">
                <div class="w-full max-w-md">
                    <div class="lg:hidden flex items-center gap-3 mb-10">
                        <div class="w-10 h-10 bg-violet-600 rounded-xl flex items-center justify-center">
                            <img src="https://unpkg.com/lucide-static@latest/icons/film.svg" class="w-5 h-5 invert">
                        </div>
                        <span class="text-xl font-bold">TG 资源爬虫</span>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">欢迎回来</h2>
                    <p class="text-slate-500 dark:text-slate-400 mb-8">请登录您的账户</p>
                    <form @submit.prevent="login" class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300">用户名</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <img src="https://unpkg.com/lucide-static@latest/icons/user.svg"
                                        class="w-5 h-5 opacity-40 dark:invert">
                                </div>
                                <input type="text" v-model="loginForm.username" required
                                    class="w-full h-12 pl-12 pr-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none transition-all"
                                    placeholder="请输入用户名">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300">密码</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <img src="https://unpkg.com/lucide-static@latest/icons/lock.svg"
                                        class="w-5 h-5 opacity-40 dark:invert">
                                </div>
                                <input type="password" v-model="loginForm.password" required
                                    class="w-full h-12 pl-12 pr-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none transition-all"
                                    placeholder="请输入密码">
                            </div>
                        </div>
                        <button type="submit" :disabled="loading"
                            class="w-full h-12 rounded-xl bg-violet-600 hover:bg-violet-700 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                            <svg v-if="loading" class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                            </svg>
                            <span>{{ loading ? '登录中...' : '登 录' }}</span>
                        </button>
                        <p v-if="error" class="text-red-500 text-sm text-center">{{ error }}</p>
                    </form>
                </div>
            </div>
        </div>

        <!-- 主界面 -->
        <div v-else class="flex h-screen overflow-hidden">
            <!-- 侧边栏 (仅桌面端显示) -->
            <aside :class="['hidden lg:flex fixed h-screen z-50 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex-col transition-all duration-300',
                      sidebarCollapsed ? 'w-20' : 'w-64']">
                <!-- Logo -->
                <div class="h-16 flex items-center gap-3 px-4 border-b border-slate-200 dark:border-slate-700">
                    <div class="w-10 h-10 bg-violet-600 rounded-lg flex items-center justify-center flex-shrink-0">
                        <img src="https://unpkg.com/lucide-static@latest/icons/film.svg" class="w-5 h-5 invert">
                    </div>
                    <span v-if="!sidebarCollapsed" class="font-bold text-lg whitespace-nowrap">TG 资源爬虫</span>
                </div>

                <!-- 导航 -->
                <nav class="flex-1 p-3 space-y-1 overflow-y-auto">
                    <a href="#" @click.prevent="currentPage = 'dashboard'; sidebarOpen = false"
                        :class="['flex items-center gap-3 h-11 px-3 rounded-xl font-medium transition-all', 
                     currentPage === 'dashboard' ? 'bg-violet-50 dark:bg-violet-900/30 text-violet-600 dark:text-violet-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50']">
                        <img src="https://unpkg.com/lucide-static@latest/icons/layout-dashboard.svg"
                            class="w-5 h-5 flex-shrink-0 dark:invert opacity-70">
                        <span v-if="!sidebarCollapsed">仪表盘</span>
                    </a>
                    <a href="#" @click.prevent="currentPage = 'search'; loadDefaultResources(); sidebarOpen = false"
                        :class="['flex items-center gap-3 h-11 px-3 rounded-xl font-medium transition-all', 
                     currentPage === 'search' ? 'bg-violet-50 dark:bg-violet-900/30 text-violet-600 dark:text-violet-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50']">
                        <img src="https://unpkg.com/lucide-static@latest/icons/search.svg"
                            class="w-5 h-5 flex-shrink-0 dark:invert opacity-70">
                        <span v-if="!sidebarCollapsed">影视搜索</span>
                    </a>
                    <a href="#" @click.prevent="currentPage = 'sync'; loadTasks(); sidebarOpen = false"
                        :class="['flex items-center gap-3 h-11 px-3 rounded-xl font-medium transition-all', 
                     currentPage === 'sync' ? 'bg-violet-50 dark:bg-violet-900/30 text-violet-600 dark:text-violet-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50']">
                        <img src="https://unpkg.com/lucide-static@latest/icons/refresh-cw.svg"
                            class="w-5 h-5 flex-shrink-0 dark:invert opacity-70">
                        <span v-if="!sidebarCollapsed">同步管理</span>
                    </a>
                    <a href="#" @click.prevent="currentPage = 'logs'; loadLogs(); sidebarOpen = false"
                        :class="['flex items-center gap-3 h-11 px-3 rounded-xl font-medium transition-all', 
                     currentPage === 'logs' ? 'bg-violet-50 dark:bg-violet-900/30 text-violet-600 dark:text-violet-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700/50']">
                        <img src="https://unpkg.com/lucide-static@latest/icons/file-text.svg"
                            class="w-5 h-5 flex-shrink-0 dark:invert opacity-70">
                        <span v-if="!sidebarCollapsed">运行日志</span>
                    </a>
                </nav>

                <!-- 折叠按钮 -->
                <button @click="sidebarCollapsed = !sidebarCollapsed"
                    class="hidden lg:flex items-center justify-center h-12 border-t border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                    <img :src="sidebarCollapsed ? 'https://unpkg.com/lucide-static@latest/icons/chevron-right.svg' : 'https://unpkg.com/lucide-static@latest/icons/chevron-left.svg'"
                        class="w-5 h-5 dark:invert opacity-60">
                </button>
            </aside>

            <!-- 主内容区 -->
            <main
                :class="['flex-1 flex flex-col h-full transition-all duration-300 min-w-0 relative pb-16 lg:pb-0', sidebarCollapsed ? 'lg:ml-20' : 'lg:ml-64']">
                <!-- 顶部栏 -->
                <header
                    class="flex-shrink-0 h-16 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-4 lg:px-8 z-10">
                    <div class="flex items-center gap-4">

                        <h1 class="text-lg lg:text-xl font-semibold">
                            {{ { dashboard: '仪表盘', search: '影视搜索', sync: '同步管理', logs: '运行日志'
                            }[currentPage] }}
                        </h1>
                    </div>
                    <div class="flex items-center gap-2 lg:gap-4">
                        <button @click="toggleTheme"
                            class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
                            <img :src="isDark ? 'https://unpkg.com/lucide-static@latest/icons/sun.svg' : 'https://unpkg.com/lucide-static@latest/icons/moon.svg'"
                                class="w-5 h-5 dark:invert">
                        </button>
                        <button @click="loadDashboard"
                            class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
                            <img src="https://unpkg.com/lucide-static@latest/icons/refresh-cw.svg"
                                class="w-5 h-5 opacity-60 dark:invert">
                        </button>
                        <!-- 退出登录按钮 -->
                        <button @click="logout"
                            class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-700 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors"
                            title="退出登录">
                            <img src="https://unpkg.com/lucide-static@latest/icons/log-out.svg"
                                class="w-5 h-5 opacity-60 dark:invert">
                        </button>
                    </div>
                </header>

                <!-- 内容区域 -->
                <div class="flex-1 overflow-y-auto p-4 lg:p-8">
                    <div class="max-w-[1920px] mx-auto">
                        <!-- 仪表盘 -->
                        <div v-if="currentPage === 'dashboard'" class="space-y-6 lg:space-y-8">
                            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-6">
                                <div
                                    class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                    <div class="flex items-center justify-between mb-3 lg:mb-4">
                                        <div
                                            class="w-10 h-10 lg:w-12 lg:h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/folder.svg"
                                                class="w-5 h-5 lg:w-6 lg:h-6">
                                        </div>
                                    </div>
                                    <div class="text-2xl lg:text-3xl font-bold">{{
                                        dashboard.total_resources?.toLocaleString() || 0 }}</div>
                                    <div class="text-xs lg:text-sm text-slate-500 dark:text-slate-400 mt-1">资源总数</div>
                                </div>
                                <div
                                    class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                    <div class="flex items-center justify-between mb-3 lg:mb-4">
                                        <div
                                            class="w-10 h-10 lg:w-12 lg:h-12 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/check-circle.svg"
                                                class="w-5 h-5 lg:w-6 lg:h-6">
                                        </div>
                                    </div>
                                    <div class="text-2xl lg:text-3xl font-bold">{{
                                        dashboard.total_parsed?.toLocaleString()
                                        || 0 }}</div>
                                    <div class="text-xs lg:text-sm text-slate-500 dark:text-slate-400 mt-1">已解析</div>
                                </div>
                                <div
                                    class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                    <div class="flex items-center justify-between mb-3 lg:mb-4">
                                        <div
                                            class="w-10 h-10 lg:w-12 lg:h-12 rounded-xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/tv.svg"
                                                class="w-5 h-5 lg:w-6 lg:h-6">
                                        </div>
                                    </div>
                                    <div class="text-2xl lg:text-3xl font-bold">{{ dashboard.channels?.length || 0 }}
                                    </div>
                                    <div class="text-xs lg:text-sm text-slate-500 dark:text-slate-400 mt-1">频道数</div>
                                </div>
                                <div
                                    class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                    <div class="flex items-center justify-between mb-3 lg:mb-4">
                                        <div
                                            :class="['w-10 h-10 lg:w-12 lg:h-12 rounded-xl flex items-center justify-center', dashboard.sync_status?.running ? 'bg-amber-100 dark:bg-amber-900/30' : 'bg-slate-100 dark:bg-slate-700']">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/activity.svg"
                                                :class="['w-5 h-5 lg:w-6 lg:h-6', dashboard.sync_status?.running ? 'animate-pulse' : '']">
                                        </div>
                                    </div>
                                    <div class="text-2xl lg:text-3xl font-bold">{{ dashboard.sync_status?.running ?
                                        '同步中' :
                                        '空闲' }}</div>
                                    <div class="text-xs lg:text-sm text-slate-500 dark:text-slate-400 mt-1">状态</div>
                                </div>
                            </div>

                            <div>
                                <h3 class="text-lg font-semibold mb-4">频道详情</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div v-for="ch in dashboard.channels" :key="ch.id"
                                        class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-5 border border-slate-200 dark:border-slate-700">
                                        <div class="flex items-center justify-between mb-4">
                                            <div>
                                                <h4 class="font-semibold">{{ ch.name }}</h4>
                                                <span class="text-xs text-slate-500 dark:text-slate-400">{{ ch.id
                                                    }}</span>
                                            </div>
                                            <span
                                                class="px-2 py-1 text-xs font-medium rounded-lg bg-violet-100 dark:bg-violet-900/30 text-violet-600 dark:text-violet-400">{{
                                                ch.parse_mode }}</span>
                                        </div>
                                        <div class="flex justify-between text-center">
                                            <div>
                                                <div
                                                    class="text-lg lg:text-xl font-bold text-blue-600 dark:text-blue-400">
                                                    {{ ch.total }}</div>
                                                <div class="text-xs text-slate-500">总数</div>
                                            </div>
                                            <div>
                                                <div
                                                    class="text-lg lg:text-xl font-bold text-emerald-600 dark:text-emerald-400">
                                                    {{ ch.parsed }}</div>
                                                <div class="text-xs text-slate-500">已解析</div>
                                            </div>
                                            <div>
                                                <div
                                                    class="text-lg lg:text-xl font-bold text-amber-600 dark:text-amber-400">
                                                    {{ ch.unparsed }}</div>
                                                <div class="text-xs text-slate-500">待解析</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 搜索页面 -->
                        <div v-if="currentPage === 'search'" class="space-y-6">
                            <div
                                class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <div class="relative flex-1">
                                        <div
                                            class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/search.svg"
                                                class="w-5 h-5 opacity-40 dark:invert">
                                        </div>
                                        <input type="text" v-model="searchQuery" @keyup.enter="doSearch()"
                                            class="w-full h-12 pl-12 pr-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"
                                            placeholder="输入关键词搜索...">
                                    </div>
                                    <select v-model="searchChannel"
                                        class="h-12 px-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none sm:w-40">
                                        <option value="">全部频道</option>
                                        <option v-for="ch in channels" :key="ch.id" :value="ch.id">{{ ch.name }}
                                        </option>
                                    </select>
                                    <button @click="doSearch()" :disabled="loading"
                                        class="h-12 px-6 rounded-xl bg-violet-600 hover:bg-violet-700 text-white font-semibold disabled:opacity-50 whitespace-nowrap">
                                        {{ loading ? '搜索中' : '搜索' }}
                                    </button>
                                </div>
                                <!-- 搜索历史 -->
                                <div v-if="searchHistory.length > 0" class="mt-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm text-slate-500 dark:text-slate-400">搜索历史</span>
                                        <button @click="clearHistory"
                                            class="text-xs text-slate-400 hover:text-red-500">清空</button>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <div v-for="h in searchHistory" :key="h"
                                            class="group flex items-center gap-1 px-3 py-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-violet-100 dark:hover:bg-violet-900/30 cursor-pointer transition-colors">
                                            <span @click="doSearch(h)" class="text-sm">{{ h }}</span>
                                            <button @click.stop="removeFromHistory(h)"
                                                class="ml-1 opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition-opacity">
                                                <img src="https://unpkg.com/lucide-static@latest/icons/x.svg"
                                                    class="w-3 h-3 dark:invert">
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div v-if="searchResults.length > 0">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="text-slate-600 dark:text-slate-400">
                                        {{ searchMode === 'search' ? '找到' : '共' }}
                                        <span class="font-semibold text-slate-900 dark:text-white">{{ searchTotal
                                            }}</span>
                                        条资源
                                        <template v-if="searchMode === 'browse'">
                                            （第 {{ searchPage }} / {{ searchTotalPages }} 页）
                                        </template>
                                    </span>
                                    <div v-if="searchMode === 'browse'" class="flex items-center gap-2">
                                        <button @click="changePage(-1)" :disabled="searchPage <= 1"
                                            class="h-9 px-4 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 disabled:opacity-50 text-sm">
                                            上一页
                                        </button>
                                        <button @click="changePage(1)" :disabled="searchPage >= searchTotalPages"
                                            class="h-9 px-4 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 disabled:opacity-50 text-sm">
                                            下一页
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4">
                                    <div v-for="item in searchResults" :key="item.message_id"
                                        class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-5 border border-slate-200 dark:border-slate-700">
                                        <div class="flex items-start justify-between mb-3">
                                            <h4 class="font-semibold text-base lg:text-lg leading-tight flex-1 mr-3">{{
                                                item.title }}</h4>
                                            <span
                                                class="px-2 py-1 text-xs rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 whitespace-nowrap">{{
                                                item.channel_name }}</span>
                                        </div>
                                        <div v-if="item.tags" class="flex flex-wrap gap-1.5 mb-3">
                                            <span v-for="tag in item.tags.split(',').slice(0,5)" :key="tag"
                                                class="px-2 py-0.5 text-xs rounded-md bg-violet-50 dark:bg-violet-900/20 text-violet-600 dark:text-violet-400">{{
                                                tag }}</span>
                                        </div>
                                        <div v-if="item.created_at"
                                            class="text-xs text-slate-400 dark:text-slate-500 mb-3">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/clock.svg"
                                                class="w-3 h-3 inline-block mr-1 opacity-60 dark:invert">
                                            {{ formatDate(item.created_at) }}
                                        </div>
                                        <div class="flex flex-wrap items-center gap-2">
                                            <button v-if="item.pan_url && item.pan_url !== 'N/A'"
                                                @click="copyLink(item.pan_url)"
                                                class="flex items-center gap-1.5 h-9 px-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium">
                                                <img src="https://unpkg.com/lucide-static@latest/icons/copy.svg"
                                                    class="w-4 h-4 invert">复制
                                            </button>
                                            <a v-if="item.pan_url && item.pan_url !== 'N/A'" :href="item.pan_url"
                                                target="_blank"
                                                class="flex items-center gap-1.5 h-9 px-3 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-sm">
                                                <img src="https://unpkg.com/lucide-static@latest/icons/external-link.svg"
                                                    class="w-4 h-4 opacity-60 dark:invert">打开
                                            </a>
                                            <a :href="'https://t.me/s/' + item.channel_username + '/' + item.message_id"
                                                target="_blank"
                                                class="flex items-center gap-1.5 h-9 px-3 rounded-lg bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 text-blue-600 dark:text-blue-400 text-sm">
                                                <img src="https://unpkg.com/lucide-static@latest/icons/message-circle.svg"
                                                    class="w-4 h-4">原消息
                                            </a>
                                            <button v-if="item.raw_html" @click="openCardPreview(item.raw_html)"
                                                class="flex items-center gap-1.5 h-9 px-3 rounded-lg bg-amber-100 dark:bg-amber-900/30 hover:bg-amber-200 dark:hover:bg-amber-900/50 text-amber-600 dark:text-amber-400 text-sm">
                                                <img src="https://unpkg.com/lucide-static@latest/icons/layout.svg"
                                                    class="w-4 h-4">原卡片
                                            </button>
                                            <button
                                                v-if="item.pan_url && (item.pan_url.includes('115.com') || item.pan_url.includes('115cdn.com'))"
                                                @click="transferToCms(item.pan_url)"
                                                class="flex items-center gap-1.5 h-9 px-3 rounded-lg bg-orange-100 dark:bg-orange-900/30 hover:bg-orange-200 dark:hover:bg-orange-900/50 text-orange-600 dark:text-orange-400 text-sm font-medium">
                                                <img src="https://unpkg.com/lucide-static@latest/icons/cloud-upload.svg"
                                                    class="w-4 h-4">转存
                                            </button>
                                            <span v-if="!item.pan_url || item.pan_url === 'N/A'"
                                                class="text-slate-400 text-sm">暂无链接</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- 底部分页 -->
                                <div v-if="searchMode === 'browse' && searchTotalPages > 1"
                                    class="flex justify-center mt-6">
                                    <div class="flex items-center gap-2">
                                        <button @click="changePage(-1)" :disabled="searchPage <= 1"
                                            class="h-10 px-5 rounded-lg bg-violet-600 hover:bg-violet-700 text-white disabled:opacity-50">
                                            上一页
                                        </button>
                                        <span class="px-4 text-slate-600 dark:text-slate-400">{{ searchPage }} / {{
                                            searchTotalPages }}</span>
                                        <button @click="changePage(1)" :disabled="searchPage >= searchTotalPages"
                                            class="h-10 px-5 rounded-lg bg-violet-600 hover:bg-violet-700 text-white disabled:opacity-50">
                                            下一页
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div v-else-if="searchPerformed"
                                class="bg-white dark:bg-slate-800 rounded-xl p-12 border border-slate-200 dark:border-slate-700 text-center">
                                <img src="https://unpkg.com/lucide-static@latest/icons/search-x.svg"
                                    class="w-12 h-12 mx-auto opacity-20 dark:invert mb-4">
                                <p class="text-slate-500 dark:text-slate-400">没有找到匹配的资源</p>
                            </div>
                        </div>

                        <!-- 同步管理 -->
                        <div v-if="currentPage === 'sync'" class="space-y-6">
                            <!-- 手动同步 -->
                            <div
                                class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                <h3 class="font-semibold mb-4 flex items-center gap-2">
                                    <img src="https://unpkg.com/lucide-static@latest/icons/play.svg"
                                        class="w-5 h-5 opacity-60 dark:invert">手动同步
                                </h3>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <select v-model="syncChannel"
                                        class="h-11 px-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                        <option value="all">全部频道</option>
                                        <option v-for="ch in channels" :key="ch.id" :value="ch.id">{{ ch.name }}
                                        </option>
                                    </select>
                                    <button @click="syncNow('incremental')" :disabled="syncRunning"
                                        class="h-11 px-6 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-medium disabled:opacity-50 flex items-center justify-center gap-2">
                                        <img src="https://unpkg.com/lucide-static@latest/icons/refresh-cw.svg"
                                            :class="['w-4 h-4 invert', syncRunning ? 'animate-spin' : '']">增量同步
                                    </button>
                                    <button @click="syncNow('full')" :disabled="syncRunning"
                                        class="h-11 px-6 rounded-xl bg-amber-600 hover:bg-amber-700 text-white font-medium disabled:opacity-50 flex items-center justify-center gap-2">
                                        <img src="https://unpkg.com/lucide-static@latest/icons/download.svg"
                                            class="w-4 h-4 invert">全量同步
                                    </button>
                                </div>
                                <div v-if="syncStatus.message"
                                    :class="['mt-4 p-4 rounded-xl text-sm', syncStatus.running ? 'bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400' : 'bg-slate-50 dark:bg-slate-900 text-slate-600 dark:text-slate-400']">
                                    {{ syncStatus.message }}
                                </div>
                            </div>

                            <!-- 定时任务 -->
                            <div
                                class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                <h3 class="font-semibold mb-4 flex items-center gap-2">
                                    <img src="https://unpkg.com/lucide-static@latest/icons/clock.svg"
                                        class="w-5 h-5 opacity-60 dark:invert">定时任务
                                </h3>
                                <div class="flex flex-col sm:flex-row gap-3 mb-6">
                                    <select v-model="newTask.channel"
                                        class="h-10 px-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                        <option value="all">全部频道</option>
                                        <option v-for="ch in channels" :key="ch.id" :value="ch.id">{{ ch.name }}
                                        </option>
                                    </select>
                                    <select v-model="newTask.mode"
                                        class="h-10 px-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                        <option value="incremental">增量同步</option>
                                        <option value="full">全量同步</option>
                                    </select>
                                    <div class="flex items-center gap-2">
                                        <input type="number" v-model="newTask.interval" min="1" max="168"
                                            class="w-20 h-10 px-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none text-center">
                                        <span class="text-sm text-slate-500">小时</span>
                                    </div>
                                    <button @click="addTask"
                                        class="h-10 px-6 rounded-xl bg-violet-600 hover:bg-violet-700 text-white font-medium whitespace-nowrap">添加</button>
                                </div>

                                <div v-if="tasks.length > 0"
                                    class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
                                    <div v-for="task in tasks" :key="task.id"
                                        class="flex items-center justify-between p-4 rounded-xl bg-slate-50 dark:bg-slate-900">
                                        <div>
                                            <div class="font-medium">{{ task.name }}</div>
                                            <div class="text-sm text-slate-500 dark:text-slate-400">下次: {{
                                                formatDate(task.next_run) }}</div>
                                        </div>
                                        <button @click="deleteTask(task.id)"
                                            class="p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-500">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/trash-2.svg"
                                                class="w-5 h-5">
                                        </button>
                                    </div>
                                </div>
                                <p v-else class="text-slate-400 text-center py-6">暂无定时任务</p>
                            </div>
                        </div>

                        <!-- 日志页面 -->
                        <div v-if="currentPage === 'logs'" class="space-y-4 lg:space-y-6">
                            <div
                                class="bg-white dark:bg-slate-800 rounded-xl lg:rounded-2xl p-4 lg:p-6 border border-slate-200 dark:border-slate-700">
                                <div
                                    class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 mb-4">
                                    <div class="flex items-center gap-3">
                                        <select v-model="logFilter" @change="loadLogs"
                                            class="h-10 px-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                            <option value="">全部类型</option>
                                            <option value="sync">手动同步</option>
                                            <option value="scheduled">定时任务</option>
                                        </select>
                                        <button @click="loadLogs"
                                            class="h-10 px-4 rounded-xl bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600">
                                            <img src="https://unpkg.com/lucide-static@latest/icons/refresh-cw.svg"
                                                class="w-4 h-4 dark:invert opacity-60">
                                        </button>
                                    </div>
                                    <button @click="clearLogs"
                                        class="h-10 px-4 rounded-xl bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 text-sm font-medium">
                                        清空日志
                                    </button>
                                </div>

                                <div v-if="logs.length > 0" class="space-y-2">
                                    <div v-for="log in logs" :key="log.id" :class="['p-4 rounded-xl border', 
                                             log.status === 'success' ? 'bg-emerald-50 dark:bg-emerald-900/10 border-emerald-200 dark:border-emerald-900/30' :
                                             log.status === 'error' ? 'bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900/30' :
                                             log.status === 'warning' ? 'bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-900/30' :
                                             'bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-700']">
                                        <div class="flex items-start justify-between gap-3">
                                            <div class="flex items-center gap-3">
                                                <img v-if="log.status === 'success'"
                                                    src="https://unpkg.com/lucide-static@latest/icons/check-circle.svg"
                                                    class="w-5 h-5 text-emerald-500 flex-shrink-0">
                                                <img v-else-if="log.status === 'error'"
                                                    src="https://unpkg.com/lucide-static@latest/icons/x-circle.svg"
                                                    class="w-5 h-5 text-red-500 flex-shrink-0">
                                                <img v-else-if="log.status === 'warning'"
                                                    src="https://unpkg.com/lucide-static@latest/icons/alert-circle.svg"
                                                    class="w-5 h-5 text-amber-500 flex-shrink-0">
                                                <img v-else src="https://unpkg.com/lucide-static@latest/icons/info.svg"
                                                    class="w-5 h-5 text-blue-500 dark:invert opacity-60 flex-shrink-0">
                                                <div>
                                                    <div class="font-medium text-sm">{{ log.message }}</div>
                                                    <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">
                                                        <span
                                                            class="inline-block px-1.5 py-0.5 rounded bg-slate-200 dark:bg-slate-700 mr-2">{{
                                                            log.type === 'sync' ? '手动' : '定时' }}</span>
                                                        {{ formatDate(log.timestamp) }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div v-else class="text-center py-12 text-slate-400">
                                    <img src="https://unpkg.com/lucide-static@latest/icons/inbox.svg"
                                        class="w-12 h-12 mx-auto opacity-30 dark:invert mb-3">
                                    暂无日志记录
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- 移动端底部导航栏 -->
            <nav
                class="fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 flex items-center justify-around z-50 lg:hidden">
                <button @click="currentPage = 'dashboard'"
                    :class="['flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors',
                        currentPage === 'dashboard' ? 'text-violet-600 dark:text-violet-400' : 'text-slate-500 dark:text-slate-400']">
                    <img src="https://unpkg.com/lucide-static@latest/icons/layout-dashboard.svg"
                        :class="['w-5 h-5', currentPage === 'dashboard' ? '' : 'opacity-60 dark:invert']">
                    <span class="text-xs font-medium">首页</span>
                </button>
                <button @click="currentPage = 'search'; loadDefaultResources()"
                    :class="['flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors',
                        currentPage === 'search' ? 'text-violet-600 dark:text-violet-400' : 'text-slate-500 dark:text-slate-400']">
                    <img src="https://unpkg.com/lucide-static@latest/icons/search.svg"
                        :class="['w-5 h-5', currentPage === 'search' ? '' : 'opacity-60 dark:invert']">
                    <span class="text-xs font-medium">搜索</span>
                </button>
                <button @click="currentPage = 'sync'; loadTasks()"
                    :class="['flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors',
                        currentPage === 'sync' ? 'text-violet-600 dark:text-violet-400' : 'text-slate-500 dark:text-slate-400']">
                    <img src="https://unpkg.com/lucide-static@latest/icons/refresh-cw.svg"
                        :class="['w-5 h-5', currentPage === 'sync' ? '' : 'opacity-60 dark:invert']">
                    <span class="text-xs font-medium">同步</span>
                </button>
                <button @click="currentPage = 'logs'; loadLogs()"
                    :class="['flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors',
                        currentPage === 'logs' ? 'text-violet-600 dark:text-violet-400' : 'text-slate-500 dark:text-slate-400']">
                    <img src="https://unpkg.com/lucide-static@latest/icons/file-text.svg"
                        :class="['w-5 h-5', currentPage === 'logs' ? '' : 'opacity-60 dark:invert']">
                    <span class="text-xs font-medium">日志</span>
                </button>
            </nav>
        </div>

        <!-- 原始卡片预览模态框 -->
        <div v-if="showCardModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"
            @click.self="closeCardPreview">
            <div
                class="bg-white dark:bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl">
                <div
                    class="flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700">
                    <h3 class="text-lg font-semibold">原始消息卡片</h3>
                    <button @click="closeCardPreview" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
                        <img src="https://unpkg.com/lucide-static@latest/icons/x.svg" class="w-5 h-5 dark:invert">
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(80vh-80px)] tg-card-preview" v-html="cardModalHtml"></div>
            </div>
        </div>


        <!-- Toasts 通知组件 -->
        <div class="fixed top-20 right-4 z-[90] flex flex-col gap-2 pointer-events-none">
            <transition-group name="toast">
                <div v-for="toast in toasts" :key="toast.id"
                    class="pointer-events-auto min-w-[300px] max-w-sm bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-100 dark:border-slate-700 p-4 flex items-start gap-3 transform transition-all duration-300"
                    :class="{
                    'border-l-4 border-l-emerald-500': toast.type === 'success',
                    'border-l-4 border-l-red-500': toast.type === 'error',
                    'border-l-4 border-l-blue-500': toast.type === 'info'
                }">
                    <div class="flex-shrink-0 mt-0.5">
                        <img v-if="toast.type === 'success'"
                            src="https://unpkg.com/lucide-static@latest/icons/check-circle.svg"
                            class="w-5 h-5 text-emerald-500">
                        <img v-else-if="toast.type === 'error'"
                            src="https://unpkg.com/lucide-static@latest/icons/alert-circle.svg"
                            class="w-5 h-5 text-red-500">
                        <img v-else src="https://unpkg.com/lucide-static@latest/icons/info.svg"
                            class="w-5 h-5 text-blue-500">
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-slate-800 dark:text-slate-200">{{ toast.message }}</p>
                    </div>
                    <button @click="removeToast(toast.id)"
                        class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">
                        <img src="https://unpkg.com/lucide-static@latest/icons/x.svg" class="w-4 h-4">
                    </button>
                </div>
            </transition-group>
        </div>

        <!-- 确认对话框组件 -->
        <div v-if="confirmDialog.show" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50"
            @click.self="handleConfirm(false)">
            <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-md shadow-2xl p-6 transform transition-all">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">{{ confirmDialog.title }}</h3>
                <p class="text-slate-600 dark:text-slate-400 mb-6">{{ confirmDialog.message }}</p>
                <div class="flex justify-end gap-3">
                    <button @click="handleConfirm(false)"
                        class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors">
                        取消
                    </button>
                    <button @click="handleConfirm(true)"
                        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-sm transition-colors">
                        确定
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- 样式补充 -->
    <style>
        .toast-enter-active,
        .toast-leave-active {
            transition: all 0.3s ease;
        }

        .toast-enter-from,
        .toast-leave-to {
            opacity: 0;
            transform: translateX(30px);
        }
    </style>

    <!-- Telegram 卡片样式 -->
    <style>
        .tg-card-preview {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #e7ebef;
            border-radius: 12px;
        }

        .tg-card-preview .tgme_widget_message_wrap {
            padding: 12px;
        }

        .tg-card-preview .tgme_widget_message {
            background: #fff;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .tg-card-preview .tgme_widget_message_bubble {
            padding: 0 !important;
        }

        .tg-card-preview .tgme_widget_message_text {
            font-size: 15px;
            line-height: 1.5;
            color: #000;
        }

        .tg-card-preview .tgme_widget_message_author {
            font-weight: 600;
            color: #168acd;
            margin-bottom: 4px;
        }

        .tg-card-preview a {
            color: #168acd;
            text-decoration: none;
        }

        .tg-card-preview a:hover {
            text-decoration: underline;
        }

        .tg-card-preview .tgme_widget_message_photo_wrap {
            margin: 8px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .tg-card-preview .tgme_widget_message_photo_wrap img {
            max-width: 100%;
            height: auto;
        }

        .tg-card-preview .tgme_widget_message_inline_keyboard {
            margin-top: 8px;
        }

        .tg-card-preview .tgme_widget_message_inline_button {
            display: inline-block;
            padding: 8px 16px;
            margin: 4px;
            background: #f0f0f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .dark .tg-card-preview {
            background: #1e293b;
        }

        .dark .tg-card-preview .tgme_widget_message {
            background: #334155;
        }

        .dark .tg-card-preview .tgme_widget_message_text {
            color: #e2e8f0;
        }
    </style>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="/static/js/app.js?v=2.7"></script>

</body>

</html>